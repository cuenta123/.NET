@using Subastas.Models
@using Twilio
@model Articulo


<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Subastaes</title>

    <!-- Google Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Titillium+Web:400,200,300,700,600' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,100' rel='stylesheet' type='text/css'>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="~/Content/bootstrap.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="~/Content/font-awesome.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/Content/owl.carousel.css">
    <link rel="stylesheet" href="~/Content/style.css">
    <link rel="stylesheet" href="~/Content/responsive.css">
    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery.min.js"></script>
    <!-- Galeria -->
    <script src="~/Scripts/galleria/galleria-1.4.5.min.js"></script>

    <!-- Bootstrap JS form CDN -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!-- jQuery sticky menu -->
    <script src="~/Scripts/owl.carousel.min.js"></script>
    <script src="~/Scripts/jquery.sticky.js"></script>

    <!-- jQuery easing -->
    <script src="~/Scripts/jquery.easing.1.3.min.js"></script>

    <!-- Main Script -->
    <script src="~/Scripts/main.js"></script>


    <script>
        var arrayfecha = new Array();
        var fechacogida;
        var contador;
        var fecha;
        var fecha2;
        var fecha3;
        var fecha4;
        var fecha5;

        function funcion() {

            fecha = $("#" + 1).val();
            fecha2 = $("#" + 2).val();
            fecha3 = $("#" + 3).val();
            fecha4 = $("#" + 4).val();
            fecha5 = $("#" + 5).val();
            fecha6 = $("#" + 6).val();
            fecha7 = $("#" + 7).val();
            fecha8 = $("#" + 8).val();
            fecha9 = $("#" + 9).val();
            fecha10 = $("#" + 10).val();
            fecha11 = $("#" + 11).val();
            fecha12 = $("#" + 12).val();
            fecha13 = $("#" + 13).val();
            fecha14 = $("#" + 14).val();
            fecha15 = $("#" + 15).val();
            fecha16 = $("#" + 16).val();
            fecha17 = $("#" + 17).val();
            fecha18 = $("#" + 18).val();
            fecha19 = $("#" + 19).val();
            fecha20 = $("#" + 20).val();
            fecha21 = $("#" + 21).val();
            quita();
            Resta();
        }


        function quita() {

            @{
                      ArticuloDAO artdao1 = new ArticuloDAO();
                      StaticProduct.listadoTodos = artdao1.ConsultaAllPaginado(1);
                      StaticProduct.PosicionTodos = new List<int>();
                      DateTime fechaRecogida;
                  }

            @{
                int contador =0;
                int posiciones = StaticProduct.listadoTodos.Count;
                if(posiciones<=21 & posiciones>=1) {
                    for (int j=1; j<StaticProduct.listadoTodos.Count+1; j++){
                        fechaRecogida = StaticProduct.listadoTodos[j - 1].FechaFinal;

                        if(fechaRecogida<(DateTime.Now.AddHours(8))) {
                            StaticProduct.PosicionTodos.Add(j);
                            contador++;
                            }
                        }

                    }
                if (contador > 0 )
                    {
                    Response.Redirect("~/Home/TimeOutP");             
                    StaticBloqueoMetodo.TimeOutP = false;
                    }
                  }
            setTimeout("quita()", 1000);
        }

        function Resta() {

            momento = new Date();

            var horas = 0;
            var minutos = 0;
            var segundos = 0;

            var array = new Array();
            var momento = new Date();
            var posicion = 0;

            for (j = 1; j < 22; j++) {

                if (j == 1 && fecha != undefined) {
                    var mivar = new Date(fecha);
                    posicion = 1;
                }
                if (j == 2 && fecha2 != undefined) {
                    var mivar = new Date(fecha2);
                    posicion = 2;
                }
                if (j == 3 && fecha3 != undefined) {
                    var mivar = new Date(fecha3);
                    posicion = 3;
                }
                if (j == 4 && fecha4 != undefined) {
                    var mivar = new Date(fecha4);
                    posicion = 4;
                }
                if (j == 5 && fecha5 != undefined) {
                    var mivar = new Date(fecha5);
                    posicion = 5;
                }

                if (j == 6 && fecha6 != undefined) {
                    var mivar = new Date(fecha6);
                    posicion = 6;
                }
                if (j == 7 && fecha7 != undefined) {
                    var mivar = new Date(fecha7);
                    posicion = 7;
                }
                if (j == 8 && fecha8 != undefined) {
                    var mivar = new Date(fecha8);
                    posicion = 8;
                }
                if (j == 9 && fecha9 != undefined) {
                    var mivar = new Date(fecha9);
                    posicion = 9;
                }
                if (j == 10 && fecha10 != undefined) {
                    var mivar = new Date(fecha10);
                    posicion = 10;
                }

                if (j == 11 && fecha11 != undefined) {
                    var mivar = new Date(fecha11);
                    posicion = 11;
                }
                if (j == 12 && fecha12 != undefined) {
                    var mivar = new Date(fecha12);
                    posicion = 12;
                }
                if (j == 13 && fecha13 != undefined) {
                    var mivar = new Date(fecha13);
                    posicion = 13;
                }
                if (j == 14 && fecha14 != undefined) {
                    var mivar = new Date(fecha14);
                    posicion = 14;
                }
                if (j == 15 && fecha15 != undefined) {
                    var mivar = new Date(fecha15);
                    posicion = 15;
                }

                if (j == 16 && fecha16 != undefined) {
                    var mivar = new Date(fecha16);
                    posicion = 16;
                }
                if (j == 17 && fecha17 != undefined) {
                    var mivar = new Date(fecha17);
                    posicion = 17;
                }
                if (j == 18 && fecha18 != undefined) {
                    var mivar = new Date(fecha18);
                    posicion = 18;
                }
                if (j == 19 && fecha19 != undefined) {
                    var mivar = new Date(fecha19);
                    posicion = 19;
                }
                if (j == 20 && fecha20 != undefined) {
                    var mivar = new Date(fecha20);
                    posicion = 20;
                }
                if (j == 21 && fecha21 != undefined) {
                    var mivar = new Date(fecha21);
                    posicion = 21;
                }

                var ms = (mivar.valueOf() - Date.now());

                if (ms == undefined) {



                }
                array.push(ms);
            }


            for (i = 0; i < 21; i++) {

                var tiempo = array[i];

                dias = (tiempo) / 1000 / 60 / 60 / 24;

                dias2 = Math.floor(dias);
                horas = (tiempo) / 1000 / 60 / 60 - (24 * dias2);
                horas2 = Math.floor(horas);
                minutos = (tiempo) / (1000 * 60) - (24 * 60 * dias2) - (60 * horas2);
                minutos2 = Math.floor(minutos);
                segundos = (tiempo) / 1000 - (24 * 60 * 60 * dias2) - (60 * 60 * horas2) - (60 * minutos2);
                segundos2 = Math.round(segundos);

                if (isNaN(dias2) == true) {
                    window.location = "";
                }

                $("#" + (i + 1)).val(" ");
                $("#" + (i + 1)).val(dias2 + "d:" + horas2 + "h:" + minutos2 + "m:" + segundos2 + "s");


            }
            setTimeout("Resta()", 1000);
        }

    </script>
    <!-- Smartsupp Live Chat script -->
    <script type="text/javascript">
        var _smartsupp = _smartsupp || {};
        _smartsupp.key = 'f333d169fce0d3893bf9825663f08ca8248af091';
        window.smartsupp || (function (d) {
            var s, c, o = smartsupp = function () { o._.push(arguments) }; o._ = [];
            s = d.getElementsByTagName('script')[0]; c = d.createElement('script');
            c.type = 'text/javascript'; c.charset = 'utf-8'; c.async = true;
            c.src = '//www.smartsuppchat.com/loader.js?'; s.parentNode.insertBefore(c, s);
        })(document);
    </script>


    <!--Google Analytics-->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-86819702-1', 'auto');
        ga('send', 'pageview');

    </script>
    <style>
        @@media screen and ( min-width: 781px) {
            .col-md-3 {
                width: 300px;
            }

            .footer-about-us {
                width: 25%;
            }

            .logo {
                max-width: 60%;
            }

            .product-upper a img {
                max-width: 100%;
            }
             input[type="text"] {
                width: 160px;
                font-size:medium;
            }
        }

        @@media screen and ( max-width: 780px) {
            .product-carousel-price {
                justify-content: center !important;
            }

            input[type="text"] {
                width: 160px;
                font-size:large;
            }
        }
    </style>
</head>
<body onload="funcion()">


    @if (Model.Activado != false)
        {
        if (Model.Tipo == "NoLogin")
            {
            Response.Write("<script>window.alert('Debes poner tu usuario y contraseña para poder pujar');</script>");
            }
        if (Model.Tipo == "PujaAceptada")
            {
            Response.Write("<script>window.alert('Puja aceptada');</script>");
            }
        if (Model.Tipo == "Ganador")
            {
            Response.Write("<script>window.alert('Eres el máximo pujador');</script>");
            }
        }

    <div class="header-area">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <div class="user-menu">
                        <ul>
                            <li><a href="~/Private/"><i class="fa fa-user"></i> Mi Cuenta</a></li>
                            <li><a href="~/Home/Login"><i class="fa fa-user"></i> Login</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>


        <div class="site-branding-area">
            <div class="container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="logo">
                            <h1><a href="./"><img src="~/Content/logo.png"></a></h1>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- End site branding area -->

    <div class="mainmenu-area">
        <div class="container">
            <div class="row">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="~/Home/Index">Tienda</a></li>
                        <li> <a href="~/Home/Tarifas">Tarifas</a></li>
                        <li><a href="~/Home/Login">Crear Cuenta/Entrar</a></li>
                        <li><a href="~/Home/Contacto">Contacto</a></li>     
                    </ul>
                    <p></p>
                </div>
            </div>
        </div>
    </div> <!-- End mainmenu area -->

    <div class="product-big-title-area">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="product-bit-title text-center">
                        <h2>Tienda</h2>

                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="single-product-area">
        @{
            String accountSid = "{{ AC0b1553e24a57f2aeff1edf6fe32f7069 }}"; // Your Account SID from www.twilio.com/console
            String authToken = "{{ 96adb0dd33ee151f5de767a747ce0126 }}";  // Your Auth Token from www.twilio.com/console

            TwilioRestClient twilio = new TwilioRestClient(accountSid, authToken);
            var message = twilio.SendMessage(
                "+34609184192", // From (Replace with your Twilio number)
                "+34696814001", // To (Replace with your phone number)
                "Hola esto es una prueba"
                );
        }
        <div class="container">
            <div class="row">
              
                @{

                    ArticuloDAO artdao = new ArticuloDAO();
                    PujaDAO pdao = new PujaDAO();
                    UsuarioDao udao = new UsuarioDao();
                    

                
                    if (Model == null)
                        {
                        List<Articulo> articulos = artdao.ConsultaAllPaginado(1);
                        int i = 0;
                        foreach (Articulo art in articulos)
                            {
                            if (art.FotoPrincipal == null)
                                {
                                continue;
                                }
                            decimal? preciopuja = pdao.ConsultaPrecio(articulos[i].IdArticulo);
                            i++;

                            <div class="col-md-3 col-sm-6">

                                <div class="single-shop-product">
                                    <div class="product-upper" style="text-align:center;">
                                        <h2><a href="/Home/SingleProduct?IdArticulo=@art.IdArticulo">@art.Titulo</a></h2>
                                        <a href="/Home/SingleProduct?IdArticulo=@art.IdArticulo">
                                            <img src="@Url.Content(art.FotoPrincipal)" alt="" style=" height:300px; width:350px;" />
                                        </a>
                                    </div>
                                    
                                    <div class="product-carousel-price" style="display:flex; flex-flow:row wrap; justify-content:space-around; align-items:baseline;">

                                        @{
                                                
                                            if (preciopuja == 0)
                                                {
                                                <ins style="font-size:large;  margin-top: 5px;"> @articulos[i - 1].PrecioInicial€</ins>
                                                <input type="text" id="@i" style="border:none;" value="@String.Format("{0:u}", art.FechaFinal)" />
                                                }

                                            else
                                                {

                                                <ins style="font-size:large;  margin-top: 5px;"> @preciopuja€</ins>
                                                <input type="text" id="@i" style="border:none;" value="@String.Format("{0:u}", art.FechaFinal)" />
                                              
                                                  

                                                    }
                                                
                                        }

                                        <form action="~/Home/ProductTodos?articulo=@art.IdArticulo" method="post" style="display:flex; flex-basis:100%; justify-content:center; ">
                                            <input type="submit" id="Puja" name="Puja" value="Pujar" style="width:50%;" />
                                        </form>


                                    </div>


                                </div>
                            </div>
                                                    }
                                                }
                                            else


                                                {

                                                string usuario;
                                                int Pagina;
                                                List<Puja> listadopujas = null;
                                                try
                                                    {
                                                    Pagina = (int)ViewData["Pag"];
                                                    usuario = Request.Cookies["User"]["Nick"];
                                                    listadopujas = pdao.ConsultaAllPujasArticulosByIdUsuario();
                                                    }
                                                catch
                                                    {
                                                    Pagina = 1;
                                                    }
                                                List<Articulo> ListadoArticulo = new List<Articulo>();
                                                ListadoArticulo = artdao.ConsultaAllPaginado(Pagina);


                                                int i = 0;
                                                foreach (Articulo art in ListadoArticulo)
                                                    {
                                                    decimal? preciopuja = pdao.ConsultaPrecio(ListadoArticulo[i].IdArticulo);
                                                    i++;
                                                    <div class="col-md-3 col-sm-6">

                                                        <div class="single-shop-product">
                                                            <div class="product-upper" style="text-align:center;">
                                                                <h2><a href="/Home/SingleProduct?IdArticulo=@art.IdArticulo" (long)>@art.Titulo</a></h2>
                                                                <a href="/Home/SingleProduct?IdArticulo=@art.IdArticulo">
                                                                    <img src="@Url.Content(art.FotoPrincipal)" alt="" style="height:300px;width:350px;" />
                                                                </a>
                                                            </div>

                                                            <div class="product-carousel-price" style="display:flex; flex-flow:row wrap; justify-content:center; align-items:baseline;">
                                                              
                                                                  @{
                                                                    if (preciopuja == 0)
                                                                        {

                                                                        <ins style="font-size:large;   margin-top: 5px;"> @ListadoArticulo[i - 1].PrecioInicial€</ins>
                                                                        <input type="text" style="border:none;" id="@i" value="@String.Format("{0:u}", art.FechaFinal)" />
                                                                        }
                                                                    else
                                                                        {
                                                                        <ins style="font-size:large;   margin-top: 5px;"> @preciopuja€</ins>
                                                                        <input type="text" style="border:none;" id="@i" value="@String.Format("{0:u}", art.FechaFinal)" />
                                                                      /**   foreach (Puja p in listadopujas)
                                                                              {
                                                                              if (p.IdArticulo == art.IdArticulo)
                                                                                  {
                                                                                  if (pdao.ConsultaPrecio(p.IdArticulo) == p.PujaActual)
                                                                                      {
                                                                              <!--      <p style="font-size:x-large; font-style:oblique;">Eres el maximo pujador</p>
                                                                                    break;
                                                                                      }
                                                                                  else
                                                                                      {
                                                                                    <p style="font-size:large; font-weight:800;">Te han sobrepujado</p>
                                                                                    break;
                                                                                  -->    }
                                                                                  }
                                                                              }**/ 
                                                                          }
                                                                }


                                                                <form action="~/Home/ProductTodos?articulo=@art.IdArticulo" method="post" style="display:flex; flex-basis:100%; justify-content:center; ">
                                                                    <input type="submit" id="Puja" name="Puja" value="Pujar" style="width:50%;" />
                                                                </form>
                                                            </div>

                                                        </div>
                                                    </div>
                                                                            }
                                                                        }

                }

            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="product-pagination text-center">
                        <nav>
                            <ul class="pagination">
                                <li>
                                    <a href="#" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                <li>@Html.ActionLink("1", "Paginacion", "Home", new { Pag = 1 }, null) </li>
                                <li>@Html.ActionLink("2", "Paginacion", "Home", new { Pag = 2 }, null)</li>
                                <li>
                                    <a href="#" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>

                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer-top-area">

        <div class="container">
            <div class="row">
                <div class="col-md-3 col-sm-6">
                    <div class="footer-about-us">
                        <h2>Subasta<span>es</span></h2>
                        <p>Descripcion de la empresa</p>

                    </div>
                </div>

                <div class="col-md-3 col-sm-6">
                    <div class="footer-menu">
                        <h2 class="footer-wid-title">User Navigation </h2>
                        <ul>
                            <li><a href="">My account</a></li>
                            <li><a href="">Order history</a></li>
                            <li><a href="">Wishlist</a></li>
                            <li><a href="">Vendor contact</a></li>
                            <li><a href="">Front page</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6">
                    <div class="footer-menu">
                        <h2 class="footer-wid-title">Categories</h2>
                        <ul>
                            <li><a href="">Mobile Phone</a></li>
                            <li><a href="">Home accesseries</a></li>
                            <li><a href="">LED TV</a></li>
                            <li><a href="">Computer</a></li>
                            <li><a href="">Gadets</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6">
                    <div class="footer-newsletter">
                        <h2 class="footer-wid-title">Newsletter</h2>
                        <p>Sign up to our newsletter and get exclusive deals you wont find anywhere else straight to your inbox!</p>
                        <div class="newsletter-form">
                            <input type="email" placeholder="Type your email">
                            <input type="submit" value="Subscribe">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>